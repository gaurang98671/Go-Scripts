<html>
    <head>
        <title>
            Web sockets!!
        </title>
    </head>
    <body>
        <div id="name"></div>
        <form action="sendMessage()">
            <input type="text" name="message" id="message" placeholder="Type a message">
        </form>
        <button onclick="sendMessage()">Send</button>
        <ul id="chat"></ul>
    </body>
    <script>
       
       var date= new Date()
        const ws= new WebSocket("ws://localhost:8080/ws")
        console.log("attempting connection")
        ws.onopen= ()=>{
            console.log("Successfully connected")
            ws.send("New user joined")
        }

        ws.onmessage= (m)=>{
            console.log(m)
        }

        ws.onclose= (event)=>{
            console.log("Connection closed")
            
        
        }

        ws.onerror= (error)=> {
            console.log("Error: ", error)
        }

        ws.onmessage= function (message){
            
            //Decode json to extract message
            
            
            
            //console.log(JSON.parse(message))
            
            console.log(message.data.toString())
            var element= document.createElement("li")
            var text= document.createTextNode(message.data)
            element.appendChild(text)
            document.getElementById("chat").appendChild(element)
        }

        
        function sendMessage()
        {
            
            //send json of time and userName

            const cookieValue = document.cookie.split("=")

            var msg= document.getElementById("message").value
            
            var message= {'name': cookieValue[1] , 'message': msg} 
            console.log(message['name'])
            ws.send(JSON.stringify( message))
            

            document.getElementById("message").value= "";
        }
    </script>
</html>