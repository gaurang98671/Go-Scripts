<html>
    <head>
        <title>
            Web sockets!!
        </title>
    </head>
    <body>
        <form action="sendMessage()">
            <input type="text" name="message" id="message" placeholder="Type a message">
        </form>
        <button onclick="sendMessage()">Send</button>
        <ul id="chat"></ul>
    </body>
    <script>
       
       var date= new Date()
        const ws= new WebSocket("ws://localhost:8080/ws")
        console.log("attempting connection")
        ws.onopen= ()=>{
            console.log("Successfully connected")
            ws.send("New user joined")
        }

        ws.onmessage= (m)=>{
            console.log(m)
        }

        ws.onclose= (event)=>{
            console.log("Connection closed")
        
        }

        ws.onerror= (error)=> {
            console.log("Error: ", error)
        }

        ws.onmessage= function (message){
            
            //Decode json to extract message
            
            
            var element= document.createElement("li")
            var text= document.createTextNode(message.data)
            element.appendChild(text)
            document.getElementById("chat").appendChild(element)
        }
        function sendMessage()
        {
            
            //send json of time and userName
            var msg= document.getElementById("message").value
            var time= date.getTime().toString
            var message= {"name": "gaurang", "time": time, "message": msg} 
            
            ws.send(JSON.stringify(message))
        }
    </script>
</html>